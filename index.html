<!DOCTYPE html>
<meta charset="utf-8">
<title>Substantial</title>
<style>

@import url(style.css);

.background {
  fill: #fff;
}

</style>
<!-- <script src="//jdfekete.github.io/reorder.js/lib/d3.v3.js"></script> -->
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="matrix.js"></script>

<div><div class = "title_accent" style = "margin-right:6px; width:10%">green</div><div class = "title">THE <span id = "emp">(UNGREAT)</span> STATE OF SUBSTITUTE TEACHING TODAY</div><div class = "title_accent" style = "margin-left:6px; width:100%">green</div></div>

<div id = "left">
<div id = "axis_label_div"></div>
<div id = "parallel"></div>
</div>

<!-- <div id = "middle">
</div>
 -->
<div id = "right">
  <div id = "sup_col_names"></div>
  <div id = "col_div"></div>
  <div id = "matrix"></div>
</div>

<div id = "info">
  <div id = "stats" class = "info_sec" style = "padding-right:30px; width:20%">
    <h1 id = "state_name"></h1>
  </div>
  <div id = "permits" class = "info_sec" style = "padding-right:30px; width:45%">
  </div>
  <div id = "notes" class = "info_sec" style = "width:20%">
    <h2>Other notes<h2>
  </div>
</div>

<script>
  var abrv_to_name = {
    "AL": "Alabama",
    "AK": "Alaska",
    "AZ": "Arizona",
    "AR": "Arkansas",
    "CA": "California",
    "CO": "Colorado",
    "CT": "Connecticut",
    "DE": "Delaware",
    "DC": "District Of Columbia",
    "FL": "Florida",
    "GA": "Georgia",
    "HI": "Hawaii",
    "ID": "Idaho",
    "IL": "Illinois",
    "IN": "Indiana",
    "IA": "Iowa",
    "KS": "Kansas",
    "KY": "Kentucky",
    "LA": "Louisiana",
    "ME": "Maine",
    "MD": "Maryland",
    "MA": "Massachusetts",
    "MI": "Michigan",
    "MN": "Minnesota",
    "MS": "Mississippi",
    "MO": "Missouri",
    "MT": "Montana",
    "NE": "Nebraska",
    "NV": "Nevada",
    "NH": "New Hampshire",
    "NJ": "New Jersey",
    "NM": "New Mexico",
    "NY": "New York",
    "NC": "North Carolina",
    "ND": "North Dakota",
    "OH": "Ohio",
    "OK": "Oklahoma",
    "OR": "Oregon",
    "PA": "Pennsylvania",
    "RI": "Rhode Island",
    "SC": "South Carolina",
    "SD": "South Dakota",
    "TN": "Tennessee",
    "TX": "Texas",
    "UT": "Utah",
    "VT": "Vermont",
    "VA": "Virginia",
    "WA": "Washington",
    "WV": "West Virginia",
    "WI": "Wisconsin",
    "WY": "Wyoming"
  }

  var margin = {top: 0, right: 0, bottom: 10, left: 0},
      width = 720,
      height = 770;

  var x_scale = d3.scale.ordinal().rangeBands([0, width], .02, 0);
  var y_scale = d3.scale.ordinal().rangeBands([0, height], .3, 0);

  var super_column_labels = d3.select("#sup_col_names").append("g").attr("id", "col_names");

  var column_labels = d3.select("#col_div").append("g")
    .attr("id", "cols");

  var svg = d3.select("#matrix").append("svg")
      .attr("id", "mat_svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .style("margin-left", -margin.left + "px")
    .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  selectedStates = []; 
  selectedRows = [];

  function highlightRows(start, end){
    d3.select("#state_name").text("");
    d3.select("#info").style("display", "none");

    selectedRows = [];
    selectedStates = [];
    var unselected = d3.select("#mat_svg").selectAll(".row")
      .filter(function(d){
        return (currentOrder.indexOf(d.index) > end || currentOrder.indexOf(d.index) < start);
      });

    var selected = d3.select("#mat_svg").selectAll(".row")
      .filter(function(d){
        if (currentOrder.indexOf(d.index) <= end && currentOrder.indexOf(d.index) >= start){
          selectedRows.push(d.index);
          selectedStates.push(d.state);
          return true;
        }
        return false;
      });

    selected.selectAll(".cell")
      .style("display", "inline");
    selected.selectAll(".background_cell")
      .style("display", "none");

    unselected.selectAll(".cell")
      .style("display", "none");
    unselected.selectAll(".background_cell")
      .style("display", "inline");

    for (var s = 0; s < selectedStates.length; s++){
      var stateLabel = d3.select('#' + selectedStates[s]);
      stateLabel.attr("fill", "#4A4CFF");
      stateLabel.attr("font-family", "Roboto-bold");


    
    }

    d3.select(".p_label").style("display", "none");

    foreground.style("display", function(d, i) {
      return (selectedStates.indexOf(d["State"]) > -1) ? "inline": "none";
    });
  }

  //For clicking on matrix
  function highlightRow(data){
    if (d3.event.shiftKey) { //select multiple rows
      if (selectedRows.length == 1 && selectedRows[0] != data.index){
        if (currentOrder.indexOf(selectedRows[0]) < currentOrder.indexOf(data.index)){
          highlightRows(currentOrder.indexOf(selectedRows[0]), currentOrder.indexOf(data.index));
        } else {
          highlightRows(currentOrder.indexOf(data.index), currentOrder.indexOf(selectedRows[0]));
        }
      }
      return;
    }
    state = data.state;
    if (selectedRows.length > 0){
      if (selectedRows.indexOf(data.index) > -1){
        removeHighlight();
        return;
      }
    }
    if (selectedStates.length > 0) {
      for (var s = 0; s < selectedStates.length; s++){
        d3.select("#p_label" + selectedStates[s]).style("display", "none");
        d3.select('#' + selectedStates[s]).attr("fill", "#000");
        d3.select('#' + selectedStates[s]).attr("font-family", "Roboto");
      }
    }
    selectedStates = [];
    selectedStates.push(state);
    selectedRows = [];
    selectedRows.push(data.index);

    var stateLabel = d3.select('#' + state);
    stateLabel.attr("fill", "#4A4CFF");
    stateLabel.attr("font-family", "Roboto-bold");
    foreground.style("display", function(d, i) {
      return (d["State"] == state) ? "inline": "none";
    });

    d3.select("#p_label" + state).style("display", "inline");

    var unselected = d3.select("#mat_svg").selectAll(".row")
      .filter(function(d){
        return (d.index == data.index) ? false: true;
      });

    var selected = d3.select("#mat_svg").selectAll("#row" + (data.index + 1)); //id's are numbered starting at 1

    selected.selectAll(".cell")
      .style("display", "inline");
    selected.selectAll(".background_cell")
      .style("display", "none");

    unselected.selectAll(".cell")
      .style("display", "none");
    unselected.selectAll(".background_cell")
      .style("display", "inline");

    d3.select("#state_name").text(abrv_to_name[state]);
    //d3.select("#detailed_info").text(abrv_to_name[state]);
    d3.select("#info").style("display", "block");
  
  }



  //for clicking on parallel coordinates
  function highlightState(state){
    if (typeof state != "string"){
      state = state['State'];
    }
    if (selectedRows.length > 0 && selectedStates.length > 0){
      if (selectedStates.indexOf(state) > -1){
        removeHighlight();
        return;
      }

      for (var s = 0; s < selectedStates.length; s++){
        d3.select("#p_label" + selectedStates[s]).style("display", "none");
        d3.select('#' + selectedStates[s]).attr("fill", "#000");
        d3.select('#' + selectedStates[s]).attr("font-family", "Roboto");
      }
    }
    selectedStates = [];
    selectedStates.push(state);
    selectedRows = [];

    var stateLabel = d3.select('#' + state);
    stateLabel.attr("fill", "#4A4CFF");
    stateLabel.attr("font-family", "Roboto-bold");
    foreground.style("display", function(d, i) {
      return (d["State"] == state) ? "inline": "none";
    });

    d3.select("#p_label" + state).style("display", "inline");

    var unselected = d3.select("#mat_svg").selectAll(".row")
      .filter(function(d){
        return (d["state"] == state) ? false: true;
      });

    var selected = d3.select("#mat_svg").selectAll(".row")
      .filter(function(d){
        return (d["state"] == state) ? true: false;
      })
      .each(function(d){
        selectedRows.push(d["index"]);
      });

    selected.selectAll(".cell")
      .style("display", "inline");
    selected.selectAll(".background_cell")
      .style("display", "none");

    unselected.selectAll(".cell")
      .style("display", "none");
    unselected.selectAll(".background_cell")
      .style("display", "inline");

    // d3.select("#mat_svg").selectAll(".row")
    //   .style("display", function(d){
    //     if (d["state"] == state){
    //       return "inline";
    //     } else {
    //       return "none";
    //     }
    //   });
      // .selectAll(".cell")
      // .style("stroke-width","0");

    // var state_rows = d3.select("#mat_svg").selectAll(".row")
    //   .filter(function(d){ return d["state"] == state; })
    //   .selectAll(".cell")
    //     .style("stroke", "#555")
    //     .style("stroke-width","2");

    d3.select("#state_name").text(abrv_to_name[state]);
    //d3.select("#detailed_info").text(abrv_to_name[state]);
    d3.select("#info").style("display", "block");
  }

  function removeHighlight(){
    if (selectedStates.length > 0){
      for (var s = 0; s < selectedStates.length; s++){
        d3.select("#p_label" + selectedStates[s]).style("display", "none");
        d3.select('#' + selectedStates[s]).attr("fill", "#000");
        d3.select('#' + selectedStates[s]).attr("font-family", "Roboto");
      }
    }
    foreground.style("display", "none");
    selectedStates = [];
    selectedRows = [];
    d3.select("#mat_svg").selectAll(".cell")
      .style("display", "inline");
    d3.select("#mat_svg").selectAll(".background_cell")
      .style("display", "none");
      // .selectAll(".cell")
      // .style("stroke-width","0");
    d3.select("#state_name").text("");
    d3.select("#info").style("display", "none");
  }

  d3.select("#info")
    .on('click', removeHighlight);

  currentOrder = d3.range(109); //hard coded number of rows

  d3.json("data/requirements.json", loadJson);



</script>

<script src="parallel.js"></script>

